<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Assignment | CORE Campus</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="../../assets/css/shared/sidebar.css">
    <link rel="stylesheet" href="../../assets/css/teacher/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .form-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #0f172a;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .btn-group {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #f1f5f9;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        /* Button Styles matching theme */
        .btn-primary {
            background-color: #003366;
            /* Main Theme Blue */
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 25px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover {
            background-color: #0f172a;
        }

        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .btn-cancel {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s;
        }

        .btn-cancel:hover {
            background: #f1f5f9;
            color: #0f172a;
        }
    </style>
</head>

<body>

    <div class="app-container">
        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <main class="main-content">
            <header class="top-bar">
                <div class="page-title">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <button onclick="window.location.href='assignments.html'"
                            style="background:none; border:none; cursor:pointer; font-size: 1.2rem; color: #64748b;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div>
                            <h1 id="pageHeading">Create Assignment</h1>
                            <p class="date-display">Set up tasks for your students</p>
                        </div>
                    </div>
                </div>
            </header>

            <div class="form-container">
                <form id="assignmentForm">
                    <div class="form-group">
                        <label for="title">Assignment Title</label>
                        <input type="text" id="title" class="form-control" placeholder="e.g. Binary Tree Implementation"
                            required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="subject">Course / Subject</label>
                            <select id="subject" class="form-control">
                                <option value="CS301">CS301 - Web Development</option>
                                <option value="CS204">CS204 - DBMS</option>
                                <option value="CS303">CS303 - DAA</option>
                                <option value="CS204">CS204 - DBMS Lab</option>
                                <option value="CS305">CS305 - ADP Lab</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dueDate">Due Date</label>
                            <input type="date" id="dueDate" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">Instructions / Description</label>
                        <textarea id="description" class="form-control"
                            placeholder="Detailed instructions for the students..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Attachments</label>
                        <div id="dropZone"
                            style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 2rem; text-align: center; color: #64748b; background: #f8fafc; cursor: pointer; transition: all 0.2s;">
                            <i class="fas fa-cloud-upload-alt"
                                style="font-size: 2rem; margin-bottom: 0.5rem; color: #94a3b8;"></i>
                            <p id="dropText">Drag & drop files here or click to browse</p>
                            <input type="file" id="fileInput" style="display: none;" multiple>
                        </div>
                        <div id="fileList"
                            style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.5rem;"></div>
                    </div>

                    <div class="btn-group">
                        <button type="button" onclick="window.history.back()" class="btn-cancel">Cancel</button>
                        <button type="submit" class="btn-primary" id="saveBtn">
                            <i class="fas fa-save"></i> Save Assignment
                        </button>
                    </div>
                </form>
            </div>

        </main>
    </div>

    <script src="../../assets/js/teacher/sidebar.js"></script>
    <script src="../../assets/js/shared/file-handler.js"></script>
    <script>
        // Populate Form if Editing
        const urlParams = new URLSearchParams(window.location.search);
        const mode = urlParams.get('mode');
        const title = urlParams.get('title');
        const subject = urlParams.get('subject');

        if (title) {
            document.getElementById('pageHeading').innerText = 'Edit Assignment';
            document.getElementById('title').value = title;
            document.getElementById('description').value = "Existing description would appear here...";
            if (subject) document.getElementById('subject').value = subject;

            // Mock Date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dueDate').value = today;
        }

        // Drop Zone Logic using Shared Utility
        document.addEventListener('DOMContentLoaded', () => {
            if (window.FileHandler) {
                FileHandler.initDropZone('dropZone', 'fileInput', 'fileList', (files) => {
                    document.getElementById('dropText').innerText = `${files.length} file(s) ready to upload`;
                });
            }
        });

        const dropText = document.getElementById('dropText');

        function handleFiles(files) {
            if (files.length > 0) {
                dropText.innerText = `${files.length} file(s) selected`;

                // Add to list
                Array.from(files).forEach(file => {
                    const div = document.createElement('div');
                    div.style.cssText = 'background: white; border: 1px solid #e2e8f0; padding: 0.75rem; border-radius: 6px; display: flex; align-items: center; justify-content: space-between;';
                    div.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-file-alt" style="color: #3b82f6;"></i>
                            <span style="font-size: 0.9rem; color: #0f172a;">${file.name}</span>
                        </div>
                        <button type="button" onclick="this.parentElement.remove()" style="background: none; border: none; color: #ef4444; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    fileList.appendChild(div);
                });
            }
        }

        // Handle Save
        document.getElementById('assignmentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn'); // Use ID selector

            // Basic Validation
            const titleVal = document.getElementById('title').value;
            if (!titleVal.trim()) {
                alert("Please enter an assignment title.");
                return;
            }

            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Saving...';
            // btn.style.background = '#059669'; // Optional: change color on save
            btn.disabled = true;

            setTimeout(() => {
                // Simulate backend delay
                alert('Assignment Saved Successfully!');
                window.location.href = 'assignments.html';
            }, 1000);
        });
    </script>
</body>

</html>